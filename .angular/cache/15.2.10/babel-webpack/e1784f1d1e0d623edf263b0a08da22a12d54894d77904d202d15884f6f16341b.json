{"ast":null,"code":"var _asyncToGenerator = require(\"I:/Angular/angular-blog/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nconst Fetcher = require('./fetcher.js');\nconst FileFetcher = require('./file.js');\nconst Minipass = require('minipass');\nconst tarCreateOptions = require('./util/tar-create-options.js');\nconst packlist = require('npm-packlist');\nconst tar = require('tar');\nconst _prepareDir = Symbol('_prepareDir');\nconst {\n  resolve\n} = require('path');\nconst _readPackageJson = Symbol.for('package.Fetcher._readPackageJson');\nconst runScript = require('@npmcli/run-script');\nconst _tarballFromResolved = Symbol.for('pacote.Fetcher._tarballFromResolved');\nclass DirFetcher extends Fetcher {\n  constructor(spec, opts) {\n    super(spec, opts);\n    // just the fully resolved filename\n    this.resolved = this.spec.fetchSpec;\n    this.tree = opts.tree || null;\n    this.Arborist = opts.Arborist || null;\n  }\n\n  // exposes tarCreateOptions as public API\n  static tarCreateOptions(manifest) {\n    return tarCreateOptions(manifest);\n  }\n  get types() {\n    return ['directory'];\n  }\n  [_prepareDir]() {\n    return this.manifest().then(mani => {\n      if (!mani.scripts || !mani.scripts.prepare) {\n        return;\n      }\n\n      // we *only* run prepare.\n      // pre/post-pack is run by the npm CLI for publish and pack,\n      // but this function is *also* run when installing git deps\n      const stdio = this.opts.foregroundScripts ? 'inherit' : 'pipe';\n\n      // hide the banner if silent opt is passed in, or if prepare running\n      // in the background.\n      const banner = this.opts.silent ? false : stdio === 'inherit';\n      return runScript({\n        pkg: mani,\n        event: 'prepare',\n        path: this.resolved,\n        stdio,\n        banner,\n        env: {\n          npm_package_resolved: this.resolved,\n          npm_package_integrity: this.integrity,\n          npm_package_json: resolve(this.resolved, 'package.json')\n        }\n      });\n    });\n  }\n  [_tarballFromResolved]() {\n    var _this = this;\n    if (!this.tree && !this.Arborist) {\n      throw new Error('DirFetcher requires either a tree or an Arborist constructor to pack');\n    }\n    const stream = new Minipass();\n    stream.resolved = this.resolved;\n    stream.integrity = this.integrity;\n    const {\n      prefix,\n      workspaces\n    } = this.opts;\n\n    // run the prepare script, get the list of files, and tar it up\n    // pipe to the stream, and proxy errors the chain.\n    this[_prepareDir]().then( /*#__PURE__*/_asyncToGenerator(function* () {\n      if (!_this.tree) {\n        const arb = new _this.Arborist({\n          path: _this.resolved\n        });\n        _this.tree = yield arb.loadActual();\n      }\n      return packlist(_this.tree, {\n        path: _this.resolved,\n        prefix,\n        workspaces\n      });\n    })).then(files => tar.c(tarCreateOptions(this.package), files).on('error', er => stream.emit('error', er)).pipe(stream)).catch(er => stream.emit('error', er));\n    return stream;\n  }\n  manifest() {\n    if (this.package) {\n      return Promise.resolve(this.package);\n    }\n    return this[_readPackageJson](this.resolved + '/package.json').then(mani => this.package = {\n      ...mani,\n      _integrity: this.integrity && String(this.integrity),\n      _resolved: this.resolved,\n      _from: this.from\n    });\n  }\n  packument() {\n    return FileFetcher.prototype.packument.apply(this);\n  }\n}\nmodule.exports = DirFetcher;","map":{"version":3,"names":["Fetcher","require","FileFetcher","Minipass","tarCreateOptions","packlist","tar","_prepareDir","Symbol","resolve","_readPackageJson","for","runScript","_tarballFromResolved","DirFetcher","constructor","spec","opts","resolved","fetchSpec","tree","Arborist","manifest","types","then","mani","scripts","prepare","stdio","foregroundScripts","banner","silent","pkg","event","path","env","npm_package_resolved","npm_package_integrity","integrity","npm_package_json","Error","stream","prefix","workspaces","arb","loadActual","files","c","package","on","er","emit","pipe","catch","Promise","_integrity","String","_resolved","_from","from","packument","prototype","apply","module","exports"],"sources":["I:/Angular/angular-blog/node_modules/pacote/lib/dir.js"],"sourcesContent":["const Fetcher = require('./fetcher.js')\nconst FileFetcher = require('./file.js')\nconst Minipass = require('minipass')\nconst tarCreateOptions = require('./util/tar-create-options.js')\nconst packlist = require('npm-packlist')\nconst tar = require('tar')\nconst _prepareDir = Symbol('_prepareDir')\nconst { resolve } = require('path')\nconst _readPackageJson = Symbol.for('package.Fetcher._readPackageJson')\n\nconst runScript = require('@npmcli/run-script')\n\nconst _tarballFromResolved = Symbol.for('pacote.Fetcher._tarballFromResolved')\nclass DirFetcher extends Fetcher {\n  constructor (spec, opts) {\n    super(spec, opts)\n    // just the fully resolved filename\n    this.resolved = this.spec.fetchSpec\n\n    this.tree = opts.tree || null\n    this.Arborist = opts.Arborist || null\n  }\n\n  // exposes tarCreateOptions as public API\n  static tarCreateOptions (manifest) {\n    return tarCreateOptions(manifest)\n  }\n\n  get types () {\n    return ['directory']\n  }\n\n  [_prepareDir] () {\n    return this.manifest().then(mani => {\n      if (!mani.scripts || !mani.scripts.prepare) {\n        return\n      }\n\n      // we *only* run prepare.\n      // pre/post-pack is run by the npm CLI for publish and pack,\n      // but this function is *also* run when installing git deps\n      const stdio = this.opts.foregroundScripts ? 'inherit' : 'pipe'\n\n      // hide the banner if silent opt is passed in, or if prepare running\n      // in the background.\n      const banner = this.opts.silent ? false : stdio === 'inherit'\n\n      return runScript({\n        pkg: mani,\n        event: 'prepare',\n        path: this.resolved,\n        stdio,\n        banner,\n        env: {\n          npm_package_resolved: this.resolved,\n          npm_package_integrity: this.integrity,\n          npm_package_json: resolve(this.resolved, 'package.json'),\n        },\n      })\n    })\n  }\n\n  [_tarballFromResolved] () {\n    if (!this.tree && !this.Arborist) {\n      throw new Error('DirFetcher requires either a tree or an Arborist constructor to pack')\n    }\n\n    const stream = new Minipass()\n    stream.resolved = this.resolved\n    stream.integrity = this.integrity\n\n    const { prefix, workspaces } = this.opts\n\n    // run the prepare script, get the list of files, and tar it up\n    // pipe to the stream, and proxy errors the chain.\n    this[_prepareDir]()\n      .then(async () => {\n        if (!this.tree) {\n          const arb = new this.Arborist({ path: this.resolved })\n          this.tree = await arb.loadActual()\n        }\n        return packlist(this.tree, { path: this.resolved, prefix, workspaces })\n      })\n      .then(files => tar.c(tarCreateOptions(this.package), files)\n        .on('error', er => stream.emit('error', er)).pipe(stream))\n      .catch(er => stream.emit('error', er))\n    return stream\n  }\n\n  manifest () {\n    if (this.package) {\n      return Promise.resolve(this.package)\n    }\n\n    return this[_readPackageJson](this.resolved + '/package.json')\n      .then(mani => this.package = {\n        ...mani,\n        _integrity: this.integrity && String(this.integrity),\n        _resolved: this.resolved,\n        _from: this.from,\n      })\n  }\n\n  packument () {\n    return FileFetcher.prototype.packument.apply(this)\n  }\n}\nmodule.exports = DirFetcher\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}