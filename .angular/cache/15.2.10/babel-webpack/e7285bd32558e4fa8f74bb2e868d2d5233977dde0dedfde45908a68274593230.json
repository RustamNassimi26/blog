{"ast":null,"code":"import { throwError } from 'rxjs';\nimport { environment } from '../../../../environments/environment';\nimport { catchError, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(http) {\n    this.http = http;\n  }\n  get token() {\n    const expDate = new Date(localStorage.getItem('fb-token-exp') || '{}');\n    if (new Date() > expDate) {\n      this.logout();\n      return null;\n    }\n    return localStorage.getItem('fb-token');\n  }\n  login(user) {\n    user.returnSecureToken = true;\n    return this.http.post(`https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${environment.apiKey}`, user).pipe(tap(_setToken => this.setToken), catchError(this.handleError.bind(this)));\n  }\n  logout() {\n    this.setToken(null);\n  }\n  isAuthenticated() {\n    return !!this.token;\n  }\n  handleError(error) {\n    const {\n      message\n    } = error.error.error;\n    switch (message) {\n      case 'INVALID_EMAIL':\n        break;\n      case 'INVALID_PASSWORD':\n        break;\n      case 'INVALID_EMAIL':\n        break;\n    }\n    return throwError(error);\n  }\n  setToken(response) {\n    if (response) {\n      const expDate = new Date(new Date().getTime() + +response.expiresIn * 1000);\n      localStorage.setItem('fb-token', response.idToken);\n      localStorage.setItem('fb-token-exp', expDate.toString());\n    } else {\n      localStorage.clear();\n    }\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac\n  });\n}","map":{"version":3,"mappings":"AAGA,SAAoBA,UAAU,QAAO,MAAM;AAC3C,SAAQC,WAAW,QAAO,sCAAsC;AAChE,SAAQC,UAAU,EAAEC,GAAG,QAAO,gBAAgB;;;AAG9C,OAAM,MAAOC,WAAW;EACtBC,YAAoBC,IAAgB;IAAhB,SAAI,GAAJA,IAAI;EAAe;EAEvC,IAAIC,KAAK;IACP,MAAMC,OAAO,GAAG,IAAIC,IAAI,CAACC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC;IACtE,IAAI,IAAIF,IAAI,EAAE,GAAGD,OAAO,EAAE;MACxB,IAAI,CAACI,MAAM,EAAE;MACb,OAAO,IAAI;;IAEb,OAAOF,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EACzC;EAEAE,KAAK,CAACC,IAAU;IACdA,IAAI,CAACC,iBAAiB,GAAG,IAAI;IAC7B,OAAO,IAAI,CAACT,IAAI,CAACU,IAAI,CAAC,6EAA6Ef,WAAW,CAACgB,MAAM,EAAE,EAAEH,IAAI,CAAC,CAC3HI,IAAI,CACHf,GAAG,CAAEgB,SAAS,IAAK,IAAI,CAACC,QAAQ,CAAC,EACjClB,UAAU,CAAC,IAAI,CAACmB,WAAW,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC,CACxC;EACL;EAEAV,MAAM;IACJ,IAAI,CAACQ,QAAQ,CAAC,IAAI,CAAC;EACrB;EAEAG,eAAe;IACb,OAAO,CAAC,CAAC,IAAI,CAAChB,KAAK;EACrB;EAEQc,WAAW,CAACG,KAAwB;IAC1C,MAAM;MAACC;IAAO,CAAC,GAAGD,KAAK,CAACA,KAAK,CAACA,KAAK;IACnC,QAAOC,OAAO;MACZ,KAAK,eAAe;QAEpB;MACA,KAAK,kBAAkB;QAEvB;MACA,KAAK,eAAe;QAEpB;IAAK;IAEP,OAAOzB,UAAU,CAACwB,KAAK,CAAC;EAC1B;EAEQJ,QAAQ,CAACM,QAA+B;IAC9C,IAAIA,QAAQ,EAAE;MACZ,MAAMlB,OAAO,GAAG,IAAIC,IAAI,CAAC,IAAIA,IAAI,EAAE,CAACkB,OAAO,EAAE,GAAG,CAACD,QAAQ,CAACE,SAAS,GAAG,IAAI,CAAC;MAC3ElB,YAAY,CAACmB,OAAO,CAAC,UAAU,EAAEH,QAAQ,CAACI,OAAO,CAAC;MAClDpB,YAAY,CAACmB,OAAO,CAAC,cAAc,EAAErB,OAAO,CAACuB,QAAQ,EAAE,CAAC;KACzD,MAAM;MACLrB,YAAY,CAACsB,KAAK,EAAE;;EAExB;EAAC;qBArDU5B,WAAW;EAAA;EAAA;WAAXA,WAAW;IAAA6B,SAAX7B,WAAW;EAAA","names":["throwError","environment","catchError","tap","AuthService","constructor","http","token","expDate","Date","localStorage","getItem","logout","login","user","returnSecureToken","post","apiKey","pipe","_setToken","setToken","handleError","bind","isAuthenticated","error","message","response","getTime","expiresIn","setItem","idToken","toString","clear","factory"],"sourceRoot":"","sources":["I:\\Angular\\angular-blog\\src\\app\\admin\\shared\\services\\auth.service.ts"],"sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {HttpClient, HttpErrorResponse} from '@angular/common/http';\r\nimport {FbAuthResponse, User} from '../../../shared/interfaces';\r\nimport {Observable, throwError} from 'rxjs';\r\nimport {environment} from '../../../../environments/environment';\r\nimport {catchError, tap} from 'rxjs/operators';\r\n\r\n@Injectable()\r\nexport class AuthService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  get token(): any {\r\n    const expDate = new Date(localStorage.getItem('fb-token-exp') || '{}')\r\n    if (new Date() > expDate) {\r\n      this.logout()\r\n      return null\r\n    }\r\n    return localStorage.getItem('fb-token')\r\n  }\r\n\r\n  login(user: User): Observable<any> {\r\n    user.returnSecureToken = true\r\n    return this.http.post(`https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${environment.apiKey}`, user)\r\n      .pipe(\r\n        tap((_setToken) => this.setToken),\r\n        catchError(this.handleError.bind(this))\r\n      )\r\n  }\r\n\r\n  logout() {\r\n    this.setToken(null)\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return !!this.token\r\n  }\r\n\r\n  private handleError(error: HttpErrorResponse) {\r\n    const {message} = error.error.error;\r\n    switch(message) {\r\n      case 'INVALID_EMAIL':\r\n\r\n      break\r\n      case 'INVALID_PASSWORD':\r\n\r\n      break\r\n      case 'INVALID_EMAIL':\r\n\r\n      break\r\n    }\r\n    return throwError(error) \r\n  }\r\n\r\n  private setToken(response: FbAuthResponse | null) {\r\n    if (response) {\r\n      const expDate = new Date(new Date().getTime() + +response.expiresIn * 1000)\r\n      localStorage.setItem('fb-token', response.idToken)\r\n      localStorage.setItem('fb-token-exp', expDate.toString())\r\n    } else {\r\n      localStorage.clear()\r\n    }\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}